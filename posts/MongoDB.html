<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MongoDB | byxl8112</title><meta name="keywords" content="MongoDB笔记"><meta name="author" content="byxl8112"><meta name="copyright" content="byxl8112"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MongoDB学习">
<meta property="og:type" content="article">
<meta property="og:title" content="MongoDB">
<meta property="og:url" content="https://byxl8112.github.io/posts/MongoDB.html">
<meta property="og:site_name" content="byxl8112">
<meta property="og:description" content="MongoDB学习">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/17-MongoDB.webp">
<meta property="article:published_time" content="2023-10-09T08:11:00.000Z">
<meta property="article:modified_time" content="2023-10-19T07:56:03.452Z">
<meta property="article:author" content="byxl8112">
<meta property="article:tag" content="MongoDB笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/17-MongoDB.webp"><link rel="shortcut icon" href="https://typora8112.oss-cn-beijing.aliyuncs.com/zzzw_8112/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20221130105527.jpg"><link rel="canonical" href="https://byxl8112.github.io/posts/MongoDB"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"一年之内的产物","messageNext":"技术可能存在过期"},
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MongoDB',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-10-19 15:56:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link defer rel="stylesheet" href="/css/customm.css" ><link defer rel="stylesheet" href="https://npm.elemecdn.com/xianqi-hexo/css/icon.css"><link defer rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"><link defer rel="stylesheet" href="https://npm.elemecdn.com/xianqi-hexo/css/background.css"><link defer rel="stylesheet" href="https://npm.elemecdn.com/xianqi-hexo/css/index_ee.css"><link defer rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"><meta name="generator" content="Hexo 6.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/zzzw_8112/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20221130105527.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">21</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fas fa-book"></i><span> 说说</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/List/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/List/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/17-MongoDB.webp')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">byxl8112</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fas fa-book"></i><span> 说说</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时轴</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/List/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/List/gallery/"><i class="fa-fw fas fa-image"></i><span> 相册</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comments/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MongoDB</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-09T08:11:00.000Z" title="发表于 2023-10-09 16:11:00">2023-10-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-19T07:56:03.452Z" title="更新于 2023-10-19 15:56:03">2023-10-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NoSQL/">NoSQL</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/NoSQL/MongoDB/">MongoDB</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MongoDB"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MongoDB相关概念"><a href="#MongoDB相关概念" class="headerlink" title="MongoDB相关概念"></a>MongoDB相关概念</h1><h2 id="MongoDB简介"><a href="#MongoDB简介" class="headerlink" title="MongoDB简介"></a>MongoDB简介</h2><p>MongoDB是一个开源、高性能、无模式的文档型数据库，当初的设计就是用于简化开发和方便扩展，是NoSQL数据库产品中的一种。是最像关系型数据库（MySQL）的非关系型数据库。</p>
<p>它支持的数据结构非常松散，是一种类似于 JSON 的 格式叫BSON，所以它既可以存储比较复杂的数据类型，又相当的灵活。</p>
<p>MongoDB中的记录是一个文档，它是一个由字段和值对（field:value）组成的数据结构。MongoDB文档类似于JSON对象，即一个文档认为就是一个对象。字段的数据类型是字符型，它的值除了使用基本的一些类型外，还可以包括其他文档、普通数组和文档数组。</p>
<p><strong>使用场景：</strong></p>
<p>具体的应用场景如：</p>
<p>1）社交场景，使用 MongoDB 存储存储用户信息，以及用户发表的朋友圈信息，通过地理位置索引实现附近的人、地点等功能。</p>
<p>2）游戏场景，使用 MongoDB 存储游戏用户信息，用户的装备、积分等直接以内嵌文档的形式存储，方便查询、高效率存储和访问。</p>
<p>3）物流场景，使用 MongoDB 存储订单信息，订单状态在运送过程中会不断更新，以 MongoDB 内嵌数组的形式来存储，一次查询就能将订单所有的变更读取出来。</p>
<p>4）物联网场景，使用 MongoDB 存储所有接入的智能设备信息，以及设备汇报的日志信息，并对这些信息进行多维度的分析。</p>
<p>5）视频直播，使用 MongoDB 存储用户信息、点赞互动信息等。</p>
<p>这些应用场景中，数据操作方面的共同特点是：</p>
<p>（1）数据量大</p>
<p>（2）写入操作频繁（读写都很频繁）</p>
<p>（3）价值较低的数据，对事务性要求不高</p>
<p>对于这样的数据，我们更适合使用MongoDB来实现数据的存储。相对于Mysql，MongoDB可以以更低的成本解决问题（包括学习、开发、运维等成本）</p>
<h2 id="体系结构"><a href="#体系结构" class="headerlink" title="体系结构"></a>体系结构</h2><p>MySQL和MongoDB对比</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231009162912885.png" alt="image-20231009162912885"></p>
<table>
<thead>
<tr>
<th>SQL术语&#x2F;概念</th>
<th>MongoDB术语&#x2F;概念</th>
<th>解释&#x2F;说明</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>database</td>
<td>数据库</td>
</tr>
<tr>
<td>table</td>
<td>collection</td>
<td>数据库表&#x2F;集合</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>数据记录行&#x2F;文档</td>
</tr>
<tr>
<td>colunm</td>
<td>field</td>
<td>数据字段&#x2F;域</td>
</tr>
<tr>
<td>index</td>
<td>index</td>
<td>索引</td>
</tr>
<tr>
<td>table joins</td>
<td></td>
<td>表连接，MongoDB不支持</td>
</tr>
<tr>
<td></td>
<td>嵌入文档</td>
<td>MongoDB通过嵌入式文档来替代多表连接</td>
</tr>
<tr>
<td>primary key</td>
<td>primary key</td>
<td>主键，MongoDB自动将 _id 设置为主键</td>
</tr>
</tbody></table>
<h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><p>MongoDB的最小存储单位就是文档（document）对象。文档（document）对象对应于关系型数据库的行，数据在MongoDB中以BSON（Binary-JSON）文档的格式存储在磁盘上</p>
<p>BSON（Binary Serialized Document Format）是一种类json的一种二进制形式的存储格式，简称Binay JSON。BSON和JSON一样，支持内嵌的文档对象和数组对象，但是BSON有JSON没有的一些数据类型，如Data和BinData类型。</p>
<p>BSON采用了类似于 C 语言结构体的名称、对表示方法，支持内嵌的文档对象和数组对象，具有轻量性、可遍历性、高效性的三个特点，可以有效描述非结构化数据和结构化数据。这种格式的优点是灵活性高，但它的缺点是空间利用率不是很理想。</p>
<p>Bson中，除了基本的JSON类型：string,integer,boolean,double,null,array和object，mongo还使用了特殊的数据类型。这些类型包括date,object id,binary data,regular expression 和code。每一个驱动都以特定语言的方式实现了这些类型，查看你的驱动的文档来获取详细信息。</p>
<p>BSON数据类型参考列表：</p>
<table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
<th>举例</th>
</tr>
</thead>
<tbody><tr>
<td>字符串</td>
<td>UTF-8字符串都可表示为字符串类型的数据</td>
<td>{“x” : “foobar”}</td>
</tr>
<tr>
<td>对象id</td>
<td>对象id是文档的12字节的唯一ID</td>
<td>{“X” : ObjectId()}</td>
</tr>
<tr>
<td>布尔值</td>
<td>真或者假：true 或者 false</td>
<td>{“x”:true}+</td>
</tr>
<tr>
<td>数组</td>
<td>值的集合或者列表可以表示成数组</td>
<td>{“x” ： [“a”, “b”, “c”]}</td>
</tr>
<tr>
<td>32位整数</td>
<td>类型不可用。JavaScript仅支持64位浮点数，所以32位整数会被自动转换</td>
<td>shell是不支持该类型的，shell中默认会转换成64位浮点数</td>
</tr>
<tr>
<td>64位整数</td>
<td>不支持这个类型。shell会使用一个特殊的内嵌文档来显示64位整数</td>
<td>shell是不支持该类型的，shell中默认会转换成64位浮点数</td>
</tr>
<tr>
<td>64为浮点数</td>
<td>shell中的数字就是这一种类型</td>
<td>{“x”：3.14159，”y”：3}</td>
</tr>
<tr>
<td>null</td>
<td>表示空值或者未定义的对象</td>
<td>{“x”:null}</td>
</tr>
<tr>
<td>undefined</td>
<td>文档中也可以使用未定义类型</td>
<td>{“x”:undefined}</td>
</tr>
<tr>
<td>符号</td>
<td>shell不支持，shell会将数据库中的符号类型的数据自动转换成字符串</td>
<td></td>
</tr>
<tr>
<td>正则表达式</td>
<td>文档中可以包含正则表达式，采用JavaScript的正则表达式语法</td>
<td>{“x” ： &#x2F;foobar&#x2F;i}</td>
</tr>
<tr>
<td>代码</td>
<td>文档中还可以包含JavaScript代码</td>
<td>{“x” ： function() { &#x2F;* …… *&#x2F; }}</td>
</tr>
<tr>
<td>二进制数据</td>
<td>二进制数据可以由任意字节的串组成，不过shell中无法使用</td>
<td></td>
</tr>
<tr>
<td>最大值&#x2F;最小值</td>
<td>BSON包括一个特殊类型，表示可能的最大值。shell中没有这个类型</td>
<td></td>
</tr>
</tbody></table>
<p>提示：</p>
<p>shell默认使用64位浮点型数值。{“x”：3.14}或{“x”：3}。对于整型值，可以使用NumberInt（4字节符号整数）或NumberLong（8字节符号整数），{“x”:NumberInt(“3”)}{“x”:NumberLong(“3”)}</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><p><strong>高性能：</strong></p>
<ul>
<li>MongoDB提供高性能的数据持久性。特别是：<ul>
<li>对嵌入式数据模型的支持减少了数据库系统上的 I&#x2F;O 活动</li>
<li>索引支持更快的查询，并且可以包含来自嵌入式文档和数组的键。（文本索引解决搜索的需求、TTL索引解决历史数据自动过期的需求、地理位置索引可用于构建各种 O2O 应用）</li>
<li>mmapv1 、wiredtiger、mongorocks（rocksdb）、in-memory 等多引擎支持满足各种场景需求</li>
<li>Gridfs解决文件存储的需求</li>
</ul>
</li>
</ul>
<p><strong>高可用性：</strong></p>
<ul>
<li>MongoDB的复制工具称为副本集（replica set），它可提供自动故障转移和数据冗余</li>
</ul>
<p><strong>高可扩展性：</strong></p>
<ul>
<li>MongoDB提供了水平可扩展性作为其核心功能的一部分。</li>
<li>分片将数据分部在一组集群的机器上。（海量数据存储，服务能力水平扩展）</li>
<li>从3.4开始，MongoDB支持基于片键创建数据区域。在一个平衡的集群中，MongoDB将一个区域所覆盖的读写只定向到该区域内的那些片</li>
</ul>
<p><strong>丰富的查询支持：</strong></p>
<p>MongoDB支持丰富的查询语言，支持读和写操作（CRUD），比如数据聚合、本地搜索和地理空间查询等</p>
<p><strong>其他特点：</strong> 如无模式（动态模式）、灵活的文档模型</p>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><h2 id="Windows系统中的安装启动"><a href="#Windows系统中的安装启动" class="headerlink" title="Windows系统中的安装启动"></a>Windows系统中的安装启动</h2><h3 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h3><p>可以在官网上下载。Windows系统用zip，Linux系统用tar</p>
<h3 id="解压安装启动"><a href="#解压安装启动" class="headerlink" title="解压安装启动"></a>解压安装启动</h3><p>将压缩包解压到一个目录中。</p>
<p>在解压目录中，手动建立一个目录用于存放数据文件，如 <code>/data/db</code> </p>
<ul>
<li><p>方式1 ：命令行参数方式启动服务</p>
<p>在 <code>/bin</code> 目录中打开命令行提示符，输入如下命令：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">mongod <span class="token operator">--</span>dbpath <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>data<span class="token operator">/</span>db<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>我们在启动信息中可以看到，mongoDB的默认端口是27017，如果我们想改变默认的启动端口，可以通过–port来指定端口。</p>
<blockquote>
<p>为了方便我们每次启动，可以将安装目录的 bin 目录设置到环境变量的 path 中，<code>bin</code> 目录下是一些常用命令，比如 <code>mongod</code> 是启动服务用的，<code>mongo</code> 是客户端连接服务用的</p>
</blockquote>
</li>
<li><p>方式2 ：配置文件方式启动服务</p>
<p>在解压目录中新建 <code>config</code> 文件夹，该文件夹中新建配置文件 <code>mongod.conf</code> ，内容参考如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">storage</span><span class="token operator">:</span>
#The directory where the mongod instance stores its data<span class="token punctuation">.</span>Default Value is <span class="token string">"\data\db"</span> on Windows<span class="token punctuation">.</span>
<span class="token literal-property property">dbPath</span><span class="token operator">:</span> <span class="token constant">D</span><span class="token operator">:</span>\02_Server\DBServer\mongodb<span class="token operator">-</span>win32<span class="token operator">-</span>x86_64<span class="token operator">-</span>2008plus<span class="token operator">-</span>ssl<span class="token operator">-</span><span class="token number">4.0</span><span class="token number">.1</span>\data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>详细内容参考文档 ：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/configuration-options/">https://docs.mongodb.com/manual/reference/configuration-options/</a></p>
</li>
</ul>
<p><font color='red'><strong>注意：</strong></font></p>
<ol>
<li><p>配置文件中如果使用双引号，比如路径地址，自动会将双引号的内容转义。如果不转义，则会报错：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">error<span class="token operator">-</span>parsing<span class="token operator">-</span>yaml<span class="token operator">-</span>config<span class="token operator">-</span>file<span class="token operator">-</span>yaml<span class="token operator">-</span>cpp<span class="token operator">-</span>error<span class="token operator">-</span>at<span class="token operator">-</span>line<span class="token operator">-</span><span class="token number">3</span><span class="token operator">-</span>column<span class="token operator">-</span><span class="token number">15</span><span class="token operator">-</span>unknown<span class="token operator">-</span>escape<span class="token operator">-</span>character<span class="token operator">-</span>d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>解决：</strong></p>
<ul>
<li>对 <code>\</code> 换成 <code>/</code> 或者 <code>\\</code> </li>
<li>如果路径中没有控制，则无需加引号</li>
</ul>
</li>
<li><p>配置文件中不能以 Tab 分割字段</p>
<p><strong>解决：</strong> </p>
<ul>
<li><p>将其转换成空格</p>
<p>启动方式：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">mongodb <span class="token operator">-</span>f <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>config<span class="token operator">/</span>mongod<span class="token punctuation">.</span>conf
或
mongodb <span class="token operator">--</span>config <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>config<span class="token operator">/</span>mongod<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ol>
<p><strong>更多参数配置：</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">systemLog</span><span class="token operator">:</span>
	<span class="token literal-property property">destination</span><span class="token operator">:</span> file
	#The path <span class="token keyword">of</span> the log file to which mongod or mongos should send all diagnostic logging information
	<span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"D:/02_Server/DBServer/mongodb-win32-x86_64-2008plus-ssl-4.0.1/log/mongod.log"</span>
	<span class="token literal-property property">logAppend</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token literal-property property">storage</span><span class="token operator">:</span>
	<span class="token literal-property property">journal</span><span class="token operator">:</span>
		<span class="token literal-property property">enabled</span><span class="token operator">:</span> <span class="token boolean">true</span>
	#The directory where the mongod instance stores its data<span class="token punctuation">.</span>Default Value is <span class="token string">"/data/db"</span><span class="token punctuation">.</span>
	<span class="token literal-property property">dbPath</span><span class="token operator">:</span> <span class="token string">"D:/02_Server/DBServer/mongodb-win32-x86_64-2008plus-ssl-4.0.1/data"</span>
<span class="token literal-property property">net</span><span class="token operator">:</span>
	#bindIp<span class="token operator">:</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>
	<span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">27017</span>
<span class="token literal-property property">setParameter</span><span class="token operator">:</span>
	<span class="token literal-property property">enableLocalhostAuthBypass</span><span class="token operator">:</span> <span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Shell连接-mongo命令"><a href="#Shell连接-mongo命令" class="headerlink" title="Shell连接(mongo命令)"></a>Shell连接(mongo命令)</h3><p>在命令提示符输入一下 shell 命令即可完成登录</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">mongo 
或
mongo <span class="token operator">--</span>host<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">--</span>port<span class="token operator">=</span><span class="token number">27017</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>查看已有的数据库</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">></span> show databases<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>退出mongodb</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">exit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>更多参数可以通过 help 查看</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">mongo <span class="token operator">--</span>help<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>提示：</p>
<p>MongoDB javaScript shell 是一个基于 javaScript 的解释器，所以是支持 js 程序和语法的</p>
<h3 id="Compass-图形化界面客户端"><a href="#Compass-图形化界面客户端" class="headerlink" title="Compass - 图形化界面客户端"></a>Compass - 图形化界面客户端</h3><p>在MongoDB官网下载 MongoDB Compass</p>
<p>如果是下载安装版，则按照步骤安装；如果是下载加压缩版，直接解压，执行里面的 MongoDBCompassCommunity.exe 文件即可。</p>
<p>在打开的界面中，输入主机地址、端口等相关信息，点击连接：</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231009193604912.png" alt="image-20231009193604912"></p>
<h2 id="在Linux系统中的安装启动"><a href="#在Linux系统中的安装启动" class="headerlink" title="在Linux系统中的安装启动"></a>在Linux系统中的安装启动</h2><p>目标：在Linux中部署一个单机的 MongoDB，作为生产环境下使用</p>
<p>提示：和 Windows 下操作差不多</p>
<h3 id="下载安装连接"><a href="#下载安装连接" class="headerlink" title="下载安装连接"></a>下载安装连接</h3><ol>
<li><p>官网下载，可以通过xftp传到Linux中</p>
</li>
<li><p>上传到Linux后，解压到当前目录：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">tar <span class="token operator">-</span>zxvf mongodb<span class="token operator">-</span>linux<span class="token operator">-</span>x86_64<span class="token operator">-</span><span class="token number">4.0</span><span class="token number">.10</span><span class="token punctuation">.</span>tgz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>移动解压后的文件夹到指定的目录中：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">mv mongodb<span class="token operator">-</span>linux<span class="token operator">-</span>x86_64<span class="token operator">-</span><span class="token number">4.0</span><span class="token number">.10</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>mongodb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>新建几个目录，分别用来存储数据和日志：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">#数据存储目录
mkdir <span class="token operator">-</span>p <span class="token operator">/</span>mongodb<span class="token operator">/</span>single<span class="token operator">/</span>data<span class="token operator">/</span>db
#日志存储目录
mkdir <span class="token operator">-</span>p <span class="token operator">/</span>mongodb<span class="token operator">/</span>single<span class="token operator">/</span>log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>新建并修改配置文件</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">vim <span class="token operator">/</span>mongodb<span class="token operator">/</span>single<span class="token operator">/</span>mongod<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>配置文件的内容如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">systemLog</span><span class="token operator">:</span>
#MongoDB发送所有日志输出的目标指定为文件
# #The path <span class="token keyword">of</span> the log file to which mongod or mongos should send all diagnostic logging information
  <span class="token literal-property property">destination</span><span class="token operator">:</span> file
#mongod或mongos应向其发送所有诊断日志记录信息的日志文件的路径
  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/mongodb/single/data/log/mongod.log"</span>
#当mongos或mongod实例重新启动时，mongos或mongod会将新条目附加到现有日志文件的末尾。
  <span class="token literal-property property">logAppend</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token literal-property property">storage</span><span class="token operator">:</span>
#mongod实例存储其数据的目录。storage<span class="token punctuation">.</span>dbPath设置仅适用于mongod。
##The directory where the mongod instance stores its data<span class="token punctuation">.</span>Default Value is <span class="token string">"/data/db"</span><span class="token punctuation">.</span>
  <span class="token literal-property property">dbPath</span><span class="token operator">:</span> <span class="token string">"/mongodb/single/data/db"</span>
# journal<span class="token operator">:</span>
#启用或禁用持久性日志以确保数据文件保持有效和可恢复。
  # enabled<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token literal-property property">processManagement</span><span class="token operator">:</span>
#启用在后台运行mongos或mongod进程的守护进程模式。
  <span class="token literal-property property">fork</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token literal-property property">net</span><span class="token operator">:</span>
#服务实例绑定的<span class="token constant">IP</span>，默认是localhost
  <span class="token literal-property property">bindIp</span><span class="token operator">:</span> <span class="token number">192.168</span><span class="token number">.200</span><span class="token number">.133</span>
#bindIp
#绑定的端口，默认是<span class="token number">27017</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">27017</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>启动 MongoDB 服务</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>mongodb<span class="token operator">/</span>bin<span class="token operator">/</span>mongod <span class="token operator">-</span>f <span class="token operator">/</span>mongodb<span class="token operator">/</span>single<span class="token operator">/</span>mongod<span class="token punctuation">.</span>conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>启动成功的页面会显示：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">about to fork child process<span class="token punctuation">,</span> waiting until server is ready <span class="token keyword">for</span> connections<span class="token punctuation">.</span>
forked process<span class="token operator">:</span> <span class="token number">90384</span>
child process started successfully<span class="token punctuation">,</span> parent exiting<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><font color='red'><strong>注意：</strong></font></p>
<p>如果启动后不是 <code>successfully</code> ，则是启动失败了。原因基本上就是配置文件有问题</p>
<p>可以通过进程来查看服务是否启动了：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span>root@byxlCentos<span class="token operator">-</span><span class="token number">1</span> <span class="token operator">~</span><span class="token punctuation">]</span># ps <span class="token operator">-</span>ef <span class="token operator">|</span>grep mongod
root       <span class="token number">2717</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">45</span> <span class="token operator">?</span>        <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">02</span> <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>mongodb<span class="token operator">/</span>bin<span class="token operator">/</span>mongod <span class="token operator">-</span>f <span class="token operator">/</span>mongodb<span class="token operator">/</span>single<span class="token operator">/</span>mongodb<span class="token punctuation">.</span>conf
root       <span class="token number">3057</span>   <span class="token number">2907</span>  <span class="token number">0</span> <span class="token number">19</span><span class="token operator">:</span><span class="token number">52</span> pts<span class="token operator">/</span><span class="token number">0</span>    <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> grep <span class="token operator">--</span>color<span class="token operator">=</span>auto mongod<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>分别使用mongo命令和compass 工具来连接测试</p>
<ul>
<li><p>mongo 命令</p>
<p>注意：<code>--host=自己Linux的ip地址</code>  ，port默认就是 27017这个端口</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231009195702967.png" alt="image-20231009195702967"></p>
</li>
<li><p>compass工具</p>
<p>注意要改成自己Linux的ip地址</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231009195842357.png" alt="image-20231009195842357"></p>
</li>
</ul>
<p>提示：如果远程连接不上，需要配置防火墙放行，或直接关闭Linux防火墙</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">#查看防火墙状态
systemctl status firewalld

#临时关闭防火墙
systemctl stop firewalld

#开机禁止启动防火墙
systemctl disable firewalld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>停止关闭服务</p>
<p>停止服务的方式有两种：快速关闭和标准关闭：</p>
<ul>
<li><p>快速关闭方法（快速、简单，数据可能会出错）</p>
<p>目标：通过系统的kill命令直接杀死进程：</p>
<p>杀完要检查一下，避免有的没有杀掉。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">#通过进程编号关闭节点
kill <span class="token operator">-</span><span class="token number">2</span> <span class="token number">54410</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><font color='red'><strong>补充：</strong></font> 如果一旦是因为数据损坏，则需要进行如下操作（了解）：</p>
<ol>
<li><p>删除 lock 文件：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">rm <span class="token operator">-</span>rf <span class="token operator">/</span>mongodb<span class="token operator">/</span>single<span class="token operator">/</span>data<span class="token operator">/</span>db<span class="token comment">/*.lock</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>修复数据</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>mongdb<span class="token operator">/</span>bin<span class="token operator">/</span>mongod <span class="token operator">--</span>repair <span class="token operator">--</span>dbpath<span class="token operator">=</span><span class="token operator">/</span>mongodb<span class="token operator">/</span>single<span class="token operator">/</span>data<span class="token operator">/</span>db<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
</li>
<li><p>标准的关闭方法（数据不容易出错，但麻烦）：</p>
<p>目标：通过mongo客户端中的 shutdownServer 命令来关闭服务</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//客户端登录服务，注意，这里通过localhost登录，如果需要远程登录，必须先登录认证才行。</span>
mongo <span class="token operator">--</span>port <span class="token number">27017</span>

<span class="token comment">//#切换到admin库</span>
use admin

<span class="token comment">//关闭服务</span>
db<span class="token punctuation">.</span><span class="token function">shutdownServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
</li>
</ol>
<h1 id="基本常用命令"><a href="#基本常用命令" class="headerlink" title="基本常用命令"></a>基本常用命令</h1><h2 id="案例需求"><a href="#案例需求" class="headerlink" title="案例需求"></a>案例需求</h2><p>存放文章品论的数据存放到MongoDB中，数据结构参考如下：</p>
<p>数据库：articledb</p>
<table>
<thead>
<tr>
<th>专栏文章评论</th>
<th>comment</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>字段名称</td>
<td>字段含义</td>
<td>字段类型</td>
<td>备注</td>
</tr>
<tr>
<td>_id</td>
<td>ID</td>
<td>ObjectId 或 String</td>
<td>Mongo的主键的字段</td>
</tr>
<tr>
<td>article</td>
<td>文章ID</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>content</td>
<td>评论内容</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>userid</td>
<td>评论人ID</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>nickname</td>
<td>评论人昵称</td>
<td>String</td>
<td></td>
</tr>
<tr>
<td>createdatetime</td>
<td>评论的日期时间</td>
<td>Date</td>
<td></td>
</tr>
<tr>
<td>likenum</td>
<td>点赞数</td>
<td>Int32</td>
<td></td>
</tr>
<tr>
<td>replynum</td>
<td>回复数</td>
<td>Int32</td>
<td></td>
</tr>
<tr>
<td>state</td>
<td>状态</td>
<td>String</td>
<td>0 ：不可见；1 ：可见</td>
</tr>
<tr>
<td>parentid</td>
<td>上级ID</td>
<td>String</td>
<td>如果为0表示文章的顶级评论</td>
</tr>
</tbody></table>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><h3 id="选择和创建数据库"><a href="#选择和创建数据库" class="headerlink" title="选择和创建数据库"></a>选择和创建数据库</h3><p>选择和创建数据库的语法格式：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">use 数据库名称<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果数据库不存在则自动创建，例如，以下语句创建 <code>spitdb</code> 数据库：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">use articledb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看有权限查看的所有的数据库命令</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">show dbs
或
show databases<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><font color='red'><strong>注意：</strong></font>在 MongoDB 中，集合只有在内容插入后才会创建！就是说，创建集合（数据表）后要再插入一个文档（记录），集合才会真正创建</p>
</blockquote>
<h3 id="查看当前正在使用的数据库命令"><a href="#查看当前正在使用的数据库命令" class="headerlink" title="查看当前正在使用的数据库命令"></a>查看当前正在使用的数据库命令</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>MongoDB 中默认的数据库为 test，如果你没有选择数据库，集合将存放在 test 数据库中。</p>
<p>另外：</p>
<p>数据库名可以是满足以下条件的任意 UTF-8 字符串</p>
<ul>
<li>不能是空字符串（””）</li>
<li>不得含有 ‘ ‘ (空格)、.  、 $ 、 &#x2F;  、 \  和 \0  （空字符）</li>
<li>应全部小写</li>
<li>最多有64字节</li>
</ul>
<p>有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库</p>
<ul>
<li><strong>admin ：</strong> 从权限的角度来看，这是 “root” 数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器</li>
<li><strong>local ：</strong> 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合</li>
<li><strong>config ：</strong> 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片和相关信息</li>
</ul>
<h3 id="数据库的删除"><a href="#数据库的删除" class="headerlink" title="数据库的删除"></a>数据库的删除</h3><p>MongoDB 删除数据库的语法格式如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span><span class="token function">dropDatabase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>提示：主要用来删除已经持久化的数据库</p>
<h2 id="集合操作"><a href="#集合操作" class="headerlink" title="集合操作"></a>集合操作</h2><p>集合，类似关系型数据库中的表</p>
<p>可以显示的创建，也可以隐式的创建</p>
<h3 id="集合的显示创建-了解"><a href="#集合的显示创建-了解" class="headerlink" title="集合的显示创建(了解)"></a>集合的显示创建(了解)</h3><p>基本语法格式：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>参数说明：</p>
<ul>
<li>name ：要创建的集合名称</li>
</ul>
<p>例如：创建一个名为 <code>mycollection</code> 的普通集合</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span><span class="token function">createCollection</span><span class="token punctuation">(</span>mycollection<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看当前库中的表：<code>show tables</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">show collections
或
show tables<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>集合的命名规范：</p>
<ul>
<li>集合名不能是空字符串 “ “ </li>
<li>集合名不能含有 \0 字符（空字符），这个字符表示集合名的结尾</li>
<li>集合名不能以 “system.” 开头，这是为系统集合保留的前缀</li>
<li>用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$</li>
</ul>
<h3 id="集合的隐式创建-常用"><a href="#集合的隐式创建-常用" class="headerlink" title="集合的隐式创建(常用)"></a>集合的隐式创建(常用)</h3><p>当向一个集合中插入一个文档的时候，如果集合不存在，则会自动创建集合（collection）。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="集合的删除"><a href="#集合的删除" class="headerlink" title="集合的删除"></a>集合的删除</h3><p>集合删除语法格式如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
或
db<span class="token punctuation">.</span>集合<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>返回值</strong></p>
<p>如果成功删除选定集合，则 drop() 方法返回 true ，否则返回false</p>
<p>例如：要删除 mycollection 集合</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>mycollection<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="文档基本CRUD"><a href="#文档基本CRUD" class="headerlink" title="文档基本CRUD"></a>文档基本CRUD</h2><p>文档（document）的数据结构和 JSON 基本一样</p>
<p>所有存储在集合中的数据都是 BSON 格式</p>
<h3 id="文档的插入"><a href="#文档的插入" class="headerlink" title="文档的插入"></a>文档的插入</h3><ol>
<li><p>单个文档的插入</p>
<p>使用 insert() 或 save() 方法向集合中插入文档，语法如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>
	<span class="token operator">&lt;</span>document or array <span class="token keyword">of</span> documents<span class="token operator">></span><span class="token punctuation">,</span>
	<span class="token punctuation">&#123;</span>
		<span class="token literal-property property">writeConcern</span><span class="token operator">:</span> <span class="token operator">&lt;</span>document<span class="token operator">></span><span class="token punctuation">,</span>
		<span class="token literal-property property">ordered</span><span class="token operator">:</span> <span class="token operator">&lt;</span>boolean<span class="token operator">></span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>参数：</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>document</td>
<td>document  or   array</td>
<td>要插入到集合中的文档或文档数组（json格式）</td>
</tr>
<tr>
<td>writeConcern</td>
<td>document</td>
<td>Optional. A document expressing the write concern. Omit to use the default write concern.See Write Concern.Do not explicitly set the write concern for the operation if run in a</td>
</tr>
<tr>
<td>ordered</td>
<td>boolean</td>
<td>可选。如果为真，则按顺序插入数组中的文档，如果其中一个文档出现错误，MongoDB将返回而不处理数组中的其余文档。如果为假，则执行无序插入，如果其中一个文档出现错误，则继续处理数组中的主文档。在版本2.6+中默认为true</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<p>向comment集合（表）中插入一条测试数据：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token string-property property">"articleid"</span><span class="token operator">:</span><span class="token string">"100000"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"content"</span><span class="token operator">:</span><span class="token string">"今天天气真好，阳光明媚"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"userid"</span><span class="token operator">:</span><span class="token string">"1001"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"nickname"</span><span class="token operator">:</span><span class="token string">"Rose"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"createdatetime"</span><span class="token operator">:</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token string-property property">"likenum"</span><span class="token operator">:</span><span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token string-property property">"state"</span><span class="token operator">:</span><span class="token keyword">null</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>提示：</p>
<ul>
<li>comment集合如果不存在，则会隐式创建</li>
<li>mongo中的数字，默认情况下是 doouble 类型，如果要存整型，必须使用函数 NumberInt（整型数字），否则取出来就有问题了</li>
<li>插入当前日期使用 <code>new Date()</code> </li>
<li>插入的数据没有指定 <code>_id</code> ，会自动生成主键值</li>
<li>如果某字段没值，可以赋值为 null ，或不写该字段</li>
</ul>
<p>执行后，如下，说明插入一个数据成功了。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">writeResult</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string-property property">"nInserted"</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><font color='red'><strong>注意：</strong></font></p>
<ul>
<li>文档中的键&#x2F;值对是有序的</li>
<li>文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档）</li>
<li>MongoDB 区分类型和大小写</li>
<li>MongoDB 的文档不能有重复的键</li>
<li>文档的键是字符串，除了少数例外情况，键可以使用任意 UTF-8 字符</li>
</ul>
<p><strong>文档键命名规范：</strong></p>
<ul>
<li>键不能含有 \0 （空字符），这个字符用来表示键的结尾</li>
<li>. 和 $ 有特别的意义，只有在特定环境下才能使用</li>
<li>以下划线 “_” 开头的键是保留的（不是严格要求的）</li>
</ul>
</li>
<li><p>批量插入</p>
<p>语法：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span>
	<span class="token punctuation">[</span> <span class="token operator">&lt;</span>document <span class="token number">1</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>document <span class="token number">3</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#123;</span>
		<span class="token literal-property property">writeConcern</span><span class="token operator">:</span> <span class="token operator">&lt;</span>document<span class="token operator">></span><span class="token punctuation">,</span>
		<span class="token literal-property property">ordered</span><span class="token operator">:</span> <span class="token operator">&lt;</span>boolean<span class="token operator">></span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>参数：</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>document</td>
<td>document</td>
<td>要插入到集合中的文档或文档数组。（json格式）</td>
</tr>
<tr>
<td>writeConcern</td>
<td>document</td>
<td>Optional. A document expressing the write concern. Omit to use the default write concern.Do not explicitly set the write concern for the operation if run in a transaction. To use write concern with transactions, see Transactions and Write Concern.</td>
</tr>
<tr>
<td>ordered</td>
<td>boolean</td>
<td>可选。一个布尔值，指定Mongod实例应执行有序插入还是无序插入。默认为true。</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<p>批量插入多条文章评论：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1002"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"相忘于江湖"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-05T22:08:15.522Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"我夏天空腹喝凉开水，冬天喝温开水"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1005"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"伊人憔悴"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-05T23:58:51.485Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"我一直喝凉开水，冬天夏天都喝。"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1004"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"杰克船长"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-06T01:05:06.321Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"专家说不能空腹吃饭，影响健康。"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"凯撒"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-06T08:18:35.288Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"研究表明，刚烧开的水千万不能喝，因为烫嘴。"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"凯撒"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-06T11:01:02.521Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>提示：</strong></p>
<p>插入时指定了 <code>_id</code> ，则主键就是该值。</p>
<p>如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉。</p>
<p>因为批量插入由于数据较多容易出现失败，因此使用 try catch 进行异常捕捉处理，测试的时候可以不处理，如：（了解）</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">try</span><span class="token punctuation">&#123;</span>
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"我们不应该把清晨浪费在手机上，健康很重要，一杯温水幸福你我他。"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1002"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"相忘于江湖"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-05T22:08:15.522Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"我夏天空腹喝凉开水，冬天喝温开水"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1005"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"伊人憔悴"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-05T23:58:51.485Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">888</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"我一直喝凉开水，冬天夏天都喝。"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1004"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"杰克船长"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-06T01:05:06.321Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"4"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"专家说不能空腹吃饭，影响健康。"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"凯撒"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-06T08:18:35.288Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"articleid"</span><span class="token operator">:</span> <span class="token string">"100001"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"content"</span><span class="token operator">:</span> <span class="token string">"研究表明，刚烧开的水千万不能喝，因为烫嘴。"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"userid"</span><span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nickname"</span><span class="token operator">:</span> <span class="token string">"凯撒"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"createdatetime"</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token string">"2019-08-06T11:01:02.521Z"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"likenum"</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string-property property">"state"</span><span class="token operator">:</span> <span class="token string">"1"</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
	<span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="文档的基本查询"><a href="#文档的基本查询" class="headerlink" title="文档的基本查询"></a>文档的基本查询</h3><p>查询数据的语法格式如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>query<span class="token operator">></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>projection<span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>参数：</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>query</td>
<td>document</td>
<td>可选。使用查询运算符指定选择筛选器，若要返回集合中的所有文档，请省略此参数或传递空文档  （{}）</td>
</tr>
<tr>
<td>projection</td>
<td>document</td>
<td>可选。指定要在与查询筛选器匹配的文档中返回的字段（投影）。若要返回匹配文档中的所有字段，请省略此参数</td>
</tr>
</tbody></table>
<p><strong>示例：</strong></p>
<ol>
<li><p>查询所有</p>
<p>如果我们要查询 spit 集合的所有文档，输入以下命令：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
或
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>这里你会发现每条文档会有一个叫 _id 的字段，这个相当于我们原来关系数据库中表的主键，当在插入文档记录时没有指定该字段，MongoDB 会自动创建，其类型时 ObjectID 类型。</p>
<p>如果在插入文档记录时指定该字段也可以，其类型可以时 ObjectID类型，也可以是MongoDB支持的任意类型。</p>
<p>如果想按一定条件来查询，例如我想查询 userid 为 1003 的记录，需要在find()中添加参数，参数也是json格式，如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span> <span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果只需要返回符合条件的第一条数据，我们可以使用 findOne 命令，语法和find 一样。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span> <span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">//只会返回第一条数据记录</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>投影查询（Projection Query）：</p>
<p>如果要查询结果返回部分字段，则需要使用投影查询（不显示所有字段，只显示指定的字段）</p>
<p>例如：查询结果只显示 <code>_id 、userid 、nickname</code> </p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">></span>db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span><span class="token string">"1002"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">nickname</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>默认 <code>_id</code> 会显示。</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231010093933385.png" alt="image-20231010093933385"></p>
<p>例如：查询结果只显示 <code>userid 、nickname</code> ，不显示 <code>_id</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">></span>db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span><span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">nickname</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span> <span class="token string-property property">"userid"</span> <span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">,</span> <span class="token string-property property">"nickname"</span> <span class="token operator">:</span> <span class="token string">"凯撒"</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#123;</span> <span class="token string-property property">"userid"</span> <span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">,</span> <span class="token string-property property">"nickname"</span> <span class="token operator">:</span> <span class="token string">"凯撒"</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231010094643848.png" alt="image-20231010094643848"></p>
<p>例如：查询所有数据，但只显示 <code>_id、userid、nickname</code> </p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">></span>db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">nickname</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231010094756809.png" alt="image-20231010094756809"></p>
</li>
</ol>
<h3 id="文档的更新"><a href="#文档的更新" class="headerlink" title="文档的更新"></a>文档的更新</h3><p>更新文档的语法：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> update<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
<span class="token comment">//或</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
	<span class="token operator">&lt;</span>query<span class="token operator">></span><span class="token punctuation">,</span>
	<span class="token operator">&lt;</span>update<span class="token operator">></span><span class="token punctuation">,</span>
	<span class="token punctuation">&#123;</span>
		<span class="token literal-property property">upset</span><span class="token operator">:</span> <span class="token operator">&lt;</span>boolean<span class="token operator">></span><span class="token punctuation">,</span>
		<span class="token literal-property property">multi</span><span class="token operator">:</span> <span class="token operator">&lt;</span>boolean<span class="token operator">></span><span class="token punctuation">,</span>
		<span class="token literal-property property">writeConcern</span><span class="token operator">:</span> <span class="token operator">&lt;</span>document<span class="token operator">></span><span class="token punctuation">,</span>
		<span class="token literal-property property">collation</span><span class="token operator">:</span> <span class="token operator">&lt;</span>document<span class="token operator">></span><span class="token punctuation">,</span>
		<span class="token literal-property property">arrayFilters</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token operator">&lt;</span>filterdocument<span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token literal-property property">hint</span><span class="token operator">:</span> <span class="token operator">&lt;</span>ducument<span class="token operator">|</span>string<span class="token operator">></span>   
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>参数：</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016080809741.png" alt="image-20231016080809741"></p>
<p>提示：</p>
<p>主要关注前四个参数即可。</p>
<p><strong>示例：</strong></p>
<ol>
<li><p>覆盖的修改</p>
<p>如果我们想修改 _id 为1的记录，点赞量为 1001 ，输入一下语句：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">likenum</span><span class="token operator">:</span><span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>执行后，我们会发现，这条文档除了 likenum 字段，其他字段都不见了</p>
</li>
<li><p>局部修改</p>
<p>为了解决这个问题，我们需要使用修改器 $set 来实现，命令如下：</p>
<p>我们想修改为 _id 为2的记录，浏览器为889，输入以下语句：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token string">"2"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">likenum</span><span class="token operator">:</span><span class="token function">NumberId</span><span class="token punctuation">(</span><span class="token number">889</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>批量的修改</p>
<p>更新所有用户为 1003 的用户的昵称为 <code>张三</code> 。</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//默认只修改第一条数据</span>
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span><span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">nickname</span><span class="token operator">:</span><span class="token string">"张三"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">//修改所有符合条件的数据</span>
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span><span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">nickname</span><span class="token operator">:</span><span class="token string">"李四"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">multi</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>提示</strong>：如果不加后面的参数<code>&#123;multi:true&#125;</code> ，则只更新符合条件的第一条记录</p>
</li>
<li><p>列值增长的修改</p>
<p>如果我们想实现对某列值在原有值的基础上进行增加或减少，可以使用 <code>inc</code> 运算符来实现。</p>
<p><strong>需求：</strong>对3号数据的点赞数，每次递增1</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">_id</span><span class="token operator">:</span><span class="token string">"3"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$inc</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">likenum</span><span class="token operator">:</span><span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><p>删除文档的语法结构：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>条件<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>以下语句可以将数据全部删除，请慎用</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果删除 _id &#x3D; 1 的记录，输入以下语句：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">id</span><span class="token operator">:</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="文档分页查询"><a href="#文档分页查询" class="headerlink" title="文档分页查询"></a>文档分页查询</h2><h3 id="统计查询"><a href="#统计查询" class="headerlink" title="统计查询"></a>统计查询</h3><p>统计查询使用 count( ) 方法，语法如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>参数：</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>query</td>
<td>document</td>
<td>查询选择条件</td>
</tr>
<tr>
<td>options</td>
<td>document</td>
<td>可选。用于修改技术的额外选项</td>
</tr>
</tbody></table>
<p><strong>提示：</strong>可选项暂时不使用</p>
<p><strong>示例：</strong></p>
<ol>
<li><p>统计所有记录数：</p>
<p>统计comment集合的所有的记录数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>按条件统计记录数：</p>
<p>统计userid为1003的记录条数：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span><span class="token string">"1002"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016085540647.png" alt="image-20231016085540647"></p>
<p>提示：默认情况下 <code>count()</code> 方法返回符合条件的全部记录条数</p>
<h3 id="分页列表查询"><a href="#分页列表查询" class="headerlink" title="分页列表查询"></a>分页列表查询</h3><p>可以使用 limit() 方法来读取指定数量的数据，使用 skip() 方法来跳过指定数量的数据。</p>
<p>基本语法如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果想返回指定条数的记录，可以在find方法后调用limit方法来返回结果，默认值20，例如：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">//表示只显示最前面的三条数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>skip 方法接收一个数字n作为跳过的记录条数（即前n个数据不要），默认值为0</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">//表示跳过前三条数据输出后面的数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>分页查询：需求：每页2个，第二页开始：跳过前两条数据，接着显示3、4条数据</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//第一页</span>
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">//第二页</span>
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">//第三页</span>
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h3><p>sort( ) 方法对数据进行排序，sort( ) 方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，-1 为降序排列</p>
<p>语法格式如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">key</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token comment">//或</span>
db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>排序方式<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>示例：</strong></p>
<p>先对 userid 降序排列，再对其中的如果有重复则对点赞数进行升序排列</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">likenum</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016091924754.png" alt="image-20231016091924754"></p>
<p><font color="red"><strong>注意：</strong></font></p>
<p>skip( )，limit( )，sort( ) 三个放在一起执行的时候，执行的顺序是先 sort( )，然后是 skip( )，最后是显示的 limit( )，和命令编写顺序无关。</p>
<h2 id="文档的更多查询"><a href="#文档的更多查询" class="headerlink" title="文档的更多查询"></a>文档的更多查询</h2><h3 id="正则的复杂条件查询"><a href="#正则的复杂条件查询" class="headerlink" title="正则的复杂条件查询"></a>正则的复杂条件查询</h3><p>MongoDB的模糊查询是通过 <strong>正则表达式</strong> 的方式实现的。格式为：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">field</span><span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">正则表达式</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>提示：</strong>正则表达式是 js 的语法，直接量的写法。</p>
<p><strong>示例：</strong> 查询评论内容包含 “开水” 的所有文档：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">开水</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查询评论内容中以 “专家” 开头的所有文档：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^专家</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016092510869.png" alt="image-20231016092510869"></p>
<h3 id="比较查询"><a href="#比较查询" class="headerlink" title="比较查询"></a>比较查询</h3><p>&lt; , &lt;&#x3D; , &gt; , &gt;&#x3D; 这个操作符很常用，格式如下：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string-property property">"field"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">$gt</span><span class="token operator">:</span> value <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// 大于: field > value</span>
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string-property property">"field"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">$lt</span><span class="token operator">:</span> value <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// 小于: field &lt; value</span>
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string-property property">"field"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">$gte</span><span class="token operator">:</span> value <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// 大于等于: field >= value</span>
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string-property property">"field"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">$lte</span><span class="token operator">:</span> value <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// 小于等于: field &lt;= value</span>
db<span class="token punctuation">.</span>集合名称<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token string-property property">"field"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">$ne</span><span class="token operator">:</span> value <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token comment">// 不等于: field != value</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>示例：</strong> 查询评论点赞数量大于 700 的记录</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">likenum</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="包含查询"><a href="#包含查询" class="headerlink" title="包含查询"></a>包含查询</h3><p>包含使用 $in 操作符。</p>
<p><strong>示例：</strong> 查询评论的集合中 userid 字段包含 1003 或 1004 的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>$<span class="token keyword">in</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"1003"</span><span class="token punctuation">,</span> <span class="token string">"1004"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016093238732.png" alt="image-20231016093238732"></p>
<p>不包含使用 $nin 操作符。</p>
<p><strong>示例：</strong> 查询评论集合中 userid 字段不包含 1003 和 1004 的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$nin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"1003"</span><span class="token punctuation">,</span> <span class="token string">"1004"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016093301932.png" alt="image-20231016093301932"></p>
<h3 id="条件连接查询"><a href="#条件连接查询" class="headerlink" title="条件连接查询"></a>条件连接查询</h3><p>如果需要查询同时满足两个以上条件，需要使用 $and 操作符将条件进行关联。（相当于 SQL 的and），格式为：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>$and<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token literal-property property">field</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">field</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">field</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>示例：</strong>查询评论集合中 likenum 大于等于 700并且小于 2000的文档：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$and</span><span class="token operator">:</span> <span class="token punctuation">[</span>
	<span class="token punctuation">&#123;</span><span class="token literal-property property">likenum</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$gte</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">700</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#123;</span><span class="token literal-property property">likenum</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$lt</span><span class="token operator">:</span><span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果两个以上条件之间是或者的关系，可以使用操作符进行关联，与前面的 and 的使用方式相同，格式为：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$or</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token literal-property property">field</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">field</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">field</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>示例：</strong>查询评论集合中 userid 为 1003，或者点赞数小于 1000 的文档记录：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$or</span><span class="token operator">:</span> <span class="token punctuation">[</span>
	<span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#123;</span><span class="token literal-property property">likenum</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="常用命令小结"><a href="#常用命令小结" class="headerlink" title="常用命令小结"></a>常用命令小结</h2><ol>
<li><p>选择切换数据库：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">use articledb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>插入数据：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">userid</span><span class="token operator">:</span><span class="token string">"1001"</span><span class="token punctuation">,</span> 
	<span class="token literal-property property">nickname</span><span class="token operator">:</span><span class="token string">"rose"</span>
	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询所有数据：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>条件查询数据：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1001"</span> 
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询符合条件的第一条记录：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1001"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询符合条件的前几条记录：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1001"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询符合条件的跳过的记录：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1001"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改数据：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>条件<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>修改后的数据<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> 
或
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>userid<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">要修改部分的字段</span><span class="token operator">:</span> 数据<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>修改数据并自增某字段</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
	<span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$inc</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">likenum</span><span class="token operator">:</span> <span class="token function">NumberInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>删除数据</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>统计查询：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>模糊查询：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">专家</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>条件比较运算</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">likenum</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>包含查询：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>$<span class="token keyword">in</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"1001"</span><span class="token punctuation">,</span> <span class="token string">"1002"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
或：
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$nin</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"1003"</span><span class="token punctuation">,</span> <span class="token string">"1004"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>条件连接查询：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">$and</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">"Rose"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
或：
db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
	<span class="token literal-property property">$or</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">"Rose"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h1 id="索引-Index"><a href="#索引-Index" class="headerlink" title="索引-Index"></a>索引-Index</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>匹配的文档。这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。</p>
<p>如果查询存在适当的索引，MongoDB可以使用该索引限制必须检查的文档数。</p>
<p>索引是特殊的数据结构，它以易于遍历的形式存储集合数据集的一小部分。索引存储特定字段或一组字段的值，按字段值排序。索引项的排序支持有效的相等匹配和基于范围的查询操作。此外，MongoDB还可以使用索引中的排序返回排序结果。</p>
<p>官网文档：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/indexes/">https://docs.mongodb.com/manual/indexes/</a></p>
<p><strong>了解：</strong></p>
<p>MongoDB索引使用B树数据结构（确切的说是B-Tree，MySQL是B+Tree）</p>
<h2 id="索引的类型"><a href="#索引的类型" class="headerlink" title="索引的类型"></a>索引的类型</h2><h3 id="单字段索引"><a href="#单字段索引" class="headerlink" title="单字段索引"></a>单字段索引</h3><p>MonogDB支持在文档的单个字段上创建用户定义的升序&#x2F;降序索引，称为单字段索引（Single Field Index）</p>
<p>对于单个字段索引和排序操作，索引键的排序顺序（即升序或降序）并不重要，因为MongoDB可以在任何方向上遍历索引。</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016151116470.png" alt="image-20231016151116470"></p>
<h3 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h3><p>MongoDB还支持多个字段的用户定义索引，即复合索引（Compound Index）。</p>
<p>复合索引中列出的字段顺序具有重要意义。例如，如果符合索引由 <code>&#123;userid: 1, score: -1&#125;</code> 组成，则索引首先按 userid 正序排序，然后在每个 userid 值内，再在按 score 倒序排序。</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016151439276.png" alt="image-20231016151439276"></p>
<h3 id="其他索引"><a href="#其他索引" class="headerlink" title="其他索引"></a>其他索引</h3><p>地理空间索引（Geospatial Index）、文本索引（Text Indexes）、哈希索引（Hashed Indexes）。</p>
<p><strong>地理空间索引（Geospatial Index）:</strong></p>
<p>为了支持对地理空间坐标数据的有效查询，MongoDB提供了两种特殊的索引：返回结果时使用平面集合的二维索引和返回结果时使用球面集合的二维球面索引。</p>
<p><strong>文本索引（Text Indexes）:</strong></p>
<p>MongoDB提供了一种文本索引类型，支持在集合中搜索字符串内容。这些文本索引不存储特定于语言的停止词（例如 “the”、“a”、“or”），而将集合中的词作为词干，只存储根词。</p>
<p><strong>哈希索引（Hashed Indexes）:</strong></p>
<p>为了支持基于散列的分片，MongoDB提供了散列索引类型，它对字段值的散列进行索引。这些索引在其范围内的值分部更加随机，但只支持相等匹配，不支持基于范围的查询。</p>
<h2 id="索引的管理操作"><a href="#索引的管理操作" class="headerlink" title="索引的管理操作"></a>索引的管理操作</h2><h3 id="索引的查看"><a href="#索引的查看" class="headerlink" title="索引的查看"></a>索引的查看</h3><p><strong>说明：</strong></p>
<p>返回一个集合中的索引的数组</p>
<p><strong>语法：</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>提示：</strong> 该语法命令运行要求时 MongoDB 3.0+</p>
<p><strong>示例：</strong>查看 comment 集合中所有的索引情况</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">getIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>结果为：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
        <span class="token string-property property">"v"</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token string-property property">"_id"</span> <span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token string-property property">"name"</span> <span class="token operator">:</span> <span class="token string">"_id_"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"ns"</span> <span class="token operator">:</span> <span class="token string">"articledb.comment"</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>结果中显示的是默认 _id 索引。</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016160043451.png" alt="image-20231016160043451"></p>
<p><strong>默认 _id 索引：</strong></p>
<p>MonogDB在创建集合的过程中，在 _id 字段上创建一个唯一的索引，默认名字为 _id ，该索引可防止客户端插入两个具有相同值的文档，您不能在 _id 字段上删除此索引。</p>
<p><font color="red"><strong>注意：</strong></font> 该索引是唯一索引，因此值不能重复，即 _id 值不能重复的。在分片集群中，通常使用 _id 作为片键。</p>
<h3 id="索引的创建"><a href="#索引的创建" class="headerlink" title="索引的创建"></a>索引的创建</h3><p><strong>说明：</strong></p>
<p>在集合上创建索引：</p>
<p><strong>语法：</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>参数：</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>keys</td>
<td>document</td>
<td>包含字段和值对的文档，其中字段是索引键，值描述该字段的索引类型。对于字段上的升序索引，请指定值1；对于降序索引，请指定值-1。比如： {字段:1或-1} ，其中1 为指定按升序创建索引，如果你想按降序来创建索引指定为 -1 即可。另外，MongoDB 支持几种不同的索引</td>
</tr>
<tr>
<td>options</td>
<td>document</td>
<td>可选。包含一组控制索引创建的选项的文档。有关详细信息，请参见选项详情列表</td>
</tr>
</tbody></table>
<p>options（更多选项）列表：</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>background</td>
<td>Boolean</td>
<td>建索引过程会阻塞其他数据库操作，background 可指定以后方式创建索引，即增加 “background” 可选参数。”background” 默认值为 false</td>
</tr>
<tr>
<td>unique</td>
<td>Boolean</td>
<td>建立的索引是否唯一。指定为 true创建唯一索引。默认值为 false</td>
</tr>
<tr>
<td>name</td>
<td>String</td>
<td>索引的名称。如果未指定，MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称</td>
</tr>
<tr>
<td>dropDups</td>
<td>Boolean</td>
<td>**3.0+**<strong>版本已废弃。</strong>在建立唯一索引时是否删除重复记录,指定 true 创建唯一索引。默认值为 false.</td>
</tr>
<tr>
<td>sparse</td>
<td>Boolean</td>
<td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为 true 的话，在索引字段中不会查询出不包含对应字段的文档。默认值为 false</td>
</tr>
<tr>
<td>expireAfterSeconds</td>
<td>integer</td>
<td>指定一个以秒为单位的数值，完成 TTL 设定，设定集合的生存时间</td>
</tr>
<tr>
<td>v</td>
<td>index version</td>
<td>索引的版本号。默认的索引版本取决于 mongod 创建索引时运行的版本</td>
</tr>
<tr>
<td>weights</td>
<td>document</td>
<td>索引权重值，数值在 1 到 99999 之间，表示该索引相对于其他索引字段的得分权重</td>
</tr>
<tr>
<td>default_language</td>
<td>String</td>
<td>对于文本索引，该参数决定了停用词及词干和词器的规则的列表。默认为英语</td>
</tr>
<tr>
<td>language_override</td>
<td>string</td>
<td>对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的 language ，默认值为 language</td>
</tr>
</tbody></table>
<p><font color="red"><strong>注意：</strong><br></font></p>
<p>在 3.0.0 版本前创建索引方法为 <code>db.collection.ensureIndex()</code> ，之后的版本使用了 <code>db.collection.createIndex()</code> 方法，<code>ensureIndex()</code> 还能用，但只是 <code>createIndex()</code> 的别名。</p>
<p><strong>示例：</strong></p>
<ol>
<li><p>单字段索引示例：对 userid 字段建立索引：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016185101501.png" alt="image-20231016185101501"> </p>
<p>参数1：按升序创建索引，索引名字为 userid</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016185233215.png" alt="image-20231016185233215"></p>
</li>
<li><p>复合索引：对 <code>userid</code> 和 <code>nickname</code> 同时建立复合（Compound）索引：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看索引：</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231016185600851.png" alt="image-20231016185600851"></p>
</li>
</ol>
<h3 id="索引的移除"><a href="#索引的移除" class="headerlink" title="索引的移除"></a>索引的移除</h3><p><strong>说明：</strong>可以移出指定的索引，或移出所有索引</p>
<p>一、指定索引的移除</p>
<p><strong>语法：</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>参数：</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>index</td>
<td>String or document</td>
<td>指定要删除的索引。可以通过索引名称或索引规范文档指定索引。若要删除文本索引，请指定索引名称</td>
</tr>
</tbody></table>
<p><strong>示例：</strong> 删除 comment 集合中 userid 字段上的上升索引：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">dropIndex</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看已经删除了</p>
<p>二、所有索引的移除</p>
<p><strong>语法：</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">dropIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>示例：</strong> 删除 spit 集合中所有的索引：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">dropIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><font color="red"><strong>注意：</strong></font> _id 的字段是无法删除的，只能删除非 _id 字段的索引。</p>
<h2 id="索引的使用"><a href="#索引的使用" class="headerlink" title="索引的使用"></a>索引的使用</h2><h3 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h3><p>分析查询性能（Analyze Query Performance）通常使用执行计划（解释计划、Explain Plan）来查看查询的情况，如查询耗费的时间、是否基于索引查询等。</p>
<p>那么，通常，我们想知道，建立的索引是否有效，效果如何，都需要通过执行计划查看。</p>
<p><strong>语法：</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">explain</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>示例：</strong> 查看根据 userid 查询数据的情况：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231017081632400.png" alt="image-20231017081632400"></p>
<p>关键看：<code>&quot;stage&quot;: &quot;COLLSCAN&quot;</code>, 表示全集合扫描</p>
<p><code>&quot;stage&quot;: &quot;INSCAN&quot;</code>, 表示索引扫描</p>
<h3 id="涵盖的查询"><a href="#涵盖的查询" class="headerlink" title="涵盖的查询"></a>涵盖的查询</h3><p>Covered Queries</p>
<p>当查询条件和查询的投影仅包含索引字段时，MongoDB直接从索引返回结果，而不扫描任何文档或将文档带入内存。这些覆盖的查询可以非常有效。</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231017082153190.png" alt="image-20231017082153190"></p>
<p>更多规则信息查看：<a target="_blank" rel="noopener" href="https://www.mongodb.com/docs/manual/core/query-optimization/#read-operations-covered-query">https://www.mongodb.com/docs/manual/core/query-optimization/#read-operations-covered-query</a></p>
<p><strong>示例：</strong></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查出的是：</p>
<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231017082758758.png" alt="image-20231017082758758"></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>comment<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token string">"1003"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">userid</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">explain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/typora-picture/image-20231017083516750.png" alt="image-20231017083516750"></p>
<h1 id="类型题"><a href="#类型题" class="headerlink" title="类型题"></a>类型题</h1><ol>
<li><p>进入 my_test 数据库</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">use my_test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>向数据库的user集合中插入一个文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"sunwukong"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询user集合中的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>向数据库的user集合中插入一个文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"zhubajie"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询数据库user集合中的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>统计数据库user集合中的文档数量</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>查询数据库user集合中的username为sunwukong的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"sunwukong"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>向数据库user集合中的username为sunwukong的文档，添加一个 address 属性，属性值为 huaguoshan</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"sunwukong"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">address</span><span class="token operator">:</span><span class="token string">"huaguoshan"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>使用 {username: “tangseng”} 替换 username 为zhubajie 的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">relaceOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"zhubajie"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"tangseng"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>删除username为sunwukong的文档的address属性</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"sunwukong"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$unset</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token literal-property property">address</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>向username为sunwukong的文档中，添加一个 hobby：<code>cities:[&quot;bwijing&quot;, &quot;shanghai&quot;, &quot;shenzhen&quot;]</code> </p>
<p>MongoDB的文档属性也可以是一个文档，当一个文档的属性值是一个文档时，我们称这个文档为  “内嵌文档”</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
    <span class="token punctuation">&#123;</span><span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"sunwukong"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> 
    <span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">cities</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"beijing"</span><span class="token punctuation">,</span><span class="token string">"shanghai"</span><span class="token punctuation">,</span><span class="token string">"shenzhen"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>向username为tangseng的文档中，添加一个hobby: <code>movies:[&quot;A Chinese Odyssey&quot;, &quot;King of comedy&quot;]</code> </p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
	<span class="token punctuation">&#123;</span><span class="token literal-property property">username</span><span class="token operator">:</span><span class="token string">"tangseng"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span><span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">hobby</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">movies</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"A Chinese Odyssey"</span><span class="token punctuation">,</span> <span class="token string">"King of comedy"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询喜欢电影 hero 的文档</p>
<p>MongoDB支持直接通过内嵌文档的属性进行查询，如果要查询内嵌文档则可以通过 . 的形式来匹配</p>
<p>如果要通过内嵌文档来对文档进行查询，此时属性名必须使用引号 即：<code>&quot;hobby.movies&quot;: &quot;hero&quot;</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token string-property property">"hobby.movies"</span><span class="token operator">:</span> <span class="token string">"hero"</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>向 tangseng 中添加一个新的电影 Interstellar</p>
<p><code>$push</code> 用于向数组中添加一个新的元素</p>
<p><code>$addToTest</code> 用于向数组中添加一个新元素，如果数组中已经存在了该元素，则不会添加</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>
    <span class="token punctuation">&#123;</span><span class="token literal-property property">user</span><span class="token operator">:</span><span class="token string">"tangseng"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
	<span class="token punctuation">&#123;</span><span class="token literal-property property">$push</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token string-property property">"hobby.movies"</span><span class="token operator">:</span> <span class="token string">"Interstellar"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>删除喜欢 beijing 的用户</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string-property property">"hobby.cities"</span><span class="token operator">:</span> <span class="token string">"beijing"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>删除user集合</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>或</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>向 numbers 中插入 20000条数据</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//效率低</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">20000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">num</span><span class="token operator">:</span> i<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//效率高</span>
<span class="token keyword">var</span> arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">20000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">num</span><span class="token operator">:</span> i<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询 numbers 中 num 为500的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token number">500</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询 numbers 中 num 大于 5000 的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$gt</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询 numbers 中 num 小于 30 的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询 numbers 中 num 大于 40 小于 50 的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询 numbers 中 num 大于 19996 的文档</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">19996</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查看 numbers 集合中的前 10 条数据</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$lte</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>或者</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>查看 numbers 集合中的第 11 条到 20 条数据</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>numebers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>查看 numbers 集合中的第 21 条到 30 条数据</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>numbers<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>将 dept 和 emp 集合导入到数据库中</p>
<p>点import然后导入</p>
</li>
<li><p>查询工资小于 2000 的员工</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>emp<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询工资在 1000 ~ 2000 之间的员工</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>emp<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询工资小于1000或大于2500的员工</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>emp<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">$or</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$lt</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$gt</span><span class="token operator">:</span> <span class="token number">2000</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p>查询财务部的所有员工</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> depno <span class="token operator">=</span> db<span class="token punctuation">.</span>dept<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">dname</span><span class="token operator">:</span> <span class="token string">"财务部"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
db<span class="token punctuation">.</span>emp<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">depno</span><span class="token operator">:</span> depno<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>查询销售部的所有员工</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> depno <span class="token operator">=</span> db<span class="token punctuation">.</span>dept<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">dname</span><span class="token operator">:</span> <span class="token string">"销售部"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>deptno<span class="token punctuation">;</span>
db<span class="token punctuation">.</span>emp<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">depno</span><span class="token operator">:</span> depno<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>查询所有 mgr 为 7698 的所有员工</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>emp<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    <span class="token literal-property property">mgr</span><span class="token operator">:</span> <span class="token number">7698</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>查询所有 mgr 为 1000 的员工增加工资 400 元</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">db<span class="token punctuation">.</span>emp<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$lte</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">$inc</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">sal</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://byxl8112.github.io">byxl8112</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://byxl8112.github.io/posts/MongoDB.html">https://byxl8112.github.io/posts/MongoDB.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://byxl8112.github.io" target="_blank">byxl8112</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MongoDB%E7%AC%94%E8%AE%B0/">MongoDB笔记</a></div><div class="post_share"><div class="social-share" data-image="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/17-MongoDB.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/gh/overtrue/share.js@master/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/money.jpg" target="_blank"><img class="post-qr-code-img" src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="/img/money.jpg"/></a><div class="post-qr-code-desc"></div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/14-2-1.html"><img class="prev-cover" src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/01-question.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CSS图标库配置(阿里和icomoon)</div></div></a></div><div class="next-post pull-right"><a href="/posts/Nginx.html"><img class="next-cover" src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/16.Nginx.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Nginx</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/zzzw_8112/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20221130105527.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">byxl8112</div><div class="author-info__description">有志者，事竟成</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">7</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">21</div></a></div><a id="card-info-btn" href="https://byxl8112.github.io"><i class="fab fa-home"></i><span>个人主页</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/byxl8112" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=1662844460&amp;website=www.qtxml.cn" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">兴趣爱好才是最大的动力，何不与我共同来攀知识高峰！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MongoDB%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">MongoDB相关概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">MongoDB简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">体系结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">数据模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">1.4.</span> <span class="toc-text">特点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">2.</span> <span class="toc-text">部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Windows%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%AE%89%E8%A3%85%E5%90%AF%E5%8A%A8"><span class="toc-number">2.1.</span> <span class="toc-text">Windows系统中的安装启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-number">2.1.1.</span> <span class="toc-text">下载安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%8E%8B%E5%AE%89%E8%A3%85%E5%90%AF%E5%8A%A8"><span class="toc-number">2.1.2.</span> <span class="toc-text">解压安装启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shell%E8%BF%9E%E6%8E%A5-mongo%E5%91%BD%E4%BB%A4"><span class="toc-number">2.1.3.</span> <span class="toc-text">Shell连接(mongo命令)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Compass-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.1.4.</span> <span class="toc-text">Compass - 图形化界面客户端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8Linux%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%AE%89%E8%A3%85%E5%90%AF%E5%8A%A8"><span class="toc-number">2.2.</span> <span class="toc-text">在Linux系统中的安装启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E8%BF%9E%E6%8E%A5"><span class="toc-number">2.2.1.</span> <span class="toc-text">下载安装连接</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">基本常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E9%9C%80%E6%B1%82"><span class="toc-number">3.1.</span> <span class="toc-text">案例需求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="toc-number">3.2.</span> <span class="toc-text">数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%92%8C%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.2.1.</span> <span class="toc-text">选择和创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%BD%93%E5%89%8D%E6%AD%A3%E5%9C%A8%E4%BD%BF%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.2.</span> <span class="toc-text">查看当前正在使用的数据库命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-number">3.2.3.</span> <span class="toc-text">数据库的删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%93%8D%E4%BD%9C"><span class="toc-number">3.3.</span> <span class="toc-text">集合操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%9A%84%E6%98%BE%E7%A4%BA%E5%88%9B%E5%BB%BA-%E4%BA%86%E8%A7%A3"><span class="toc-number">3.3.1.</span> <span class="toc-text">集合的显示创建(了解)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%9A%84%E9%9A%90%E5%BC%8F%E5%88%9B%E5%BB%BA-%E5%B8%B8%E7%94%A8"><span class="toc-number">3.3.2.</span> <span class="toc-text">集合的隐式创建(常用)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%9A%84%E5%88%A0%E9%99%A4"><span class="toc-number">3.3.3.</span> <span class="toc-text">集合的删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E5%9F%BA%E6%9C%ACCRUD"><span class="toc-number">3.4.</span> <span class="toc-text">文档基本CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E6%8F%92%E5%85%A5"><span class="toc-number">3.4.1.</span> <span class="toc-text">文档的插入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.4.2.</span> <span class="toc-text">文档的基本查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="toc-number">3.4.3.</span> <span class="toc-text">文档的更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">3.4.4.</span> <span class="toc-text">删除文档</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.5.</span> <span class="toc-text">文档分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E8%AE%A1%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.5.1.</span> <span class="toc-text">统计查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E5%88%97%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.5.2.</span> <span class="toc-text">分页列表查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.5.3.</span> <span class="toc-text">排序查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E7%9A%84%E6%9B%B4%E5%A4%9A%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.6.</span> <span class="toc-text">文档的更多查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%88%99%E7%9A%84%E5%A4%8D%E6%9D%82%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.6.1.</span> <span class="toc-text">正则的复杂条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.6.2.</span> <span class="toc-text">比较查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E5%90%AB%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.6.3.</span> <span class="toc-text">包含查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E8%BF%9E%E6%8E%A5%E6%9F%A5%E8%AF%A2"><span class="toc-number">3.6.4.</span> <span class="toc-text">条件连接查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%B0%8F%E7%BB%93"><span class="toc-number">3.7.</span> <span class="toc-text">常用命令小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-Index"><span class="toc-number">4.</span> <span class="toc-text">索引-Index</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.2.</span> <span class="toc-text">索引的类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E5%AD%97%E6%AE%B5%E7%B4%A2%E5%BC%95"><span class="toc-number">4.2.1.</span> <span class="toc-text">单字段索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E5%90%88%E7%B4%A2%E5%BC%95"><span class="toc-number">4.2.2.</span> <span class="toc-text">复合索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E7%B4%A2%E5%BC%95"><span class="toc-number">4.2.3.</span> <span class="toc-text">其他索引</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%AE%A1%E7%90%86%E6%93%8D%E4%BD%9C"><span class="toc-number">4.3.</span> <span class="toc-text">索引的管理操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E6%9F%A5%E7%9C%8B"><span class="toc-number">4.3.1.</span> <span class="toc-text">索引的查看</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">4.3.2.</span> <span class="toc-text">索引的创建</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E7%A7%BB%E9%99%A4"><span class="toc-number">4.3.3.</span> <span class="toc-text">索引的移除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.4.</span> <span class="toc-text">索引的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="toc-number">4.4.1.</span> <span class="toc-text">执行计划</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B6%B5%E7%9B%96%E7%9A%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.4.2.</span> <span class="toc-text">涵盖的查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">类型题</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/webpack.html" title="Webpack"><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/20-webpack.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Webpack"/></a><div class="content"><a class="title" href="/posts/webpack.html" title="Webpack">Webpack</a><time datetime="2023-11-16T10:00:00.000Z" title="发表于 2023-11-16 18:00:00">2023-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/webpack2.html" title="Webpack"><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/20-webpack.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Webpack"/></a><div class="content"><a class="title" href="/posts/webpack2.html" title="Webpack">Webpack</a><time datetime="2023-11-16T10:00:00.000Z" title="发表于 2023-11-16 18:00:00">2023-11-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/web-APIs.html" title="web-APIs"><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/19-web-APIs.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="web-APIs"/></a><div class="content"><a class="title" href="/posts/web-APIs.html" title="web-APIs">web-APIs</a><time datetime="2023-11-14T16:06:29.000Z" title="发表于 2023-11-15 00:06:29">2023-11-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/JS.html" title="JavaScript基础"><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/18-js.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaScript基础"/></a><div class="content"><a class="title" href="/posts/JS.html" title="JavaScript基础">JavaScript基础</a><time datetime="2023-11-13T07:01:00.000Z" title="发表于 2023-11-13 15:01:00">2023-11-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/14-2-1.html" title="CSS图标库配置(阿里和icomoon)"><img src= "/./loading.gif" data-lazy-src="/loading.gif" data-original="https://typora8112.oss-cn-beijing.aliyuncs.com/byxl8112-pictures/01-question.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSS图标库配置(阿里和icomoon)"/></a><div class="content"><a class="title" href="/posts/14-2-1.html" title="CSS图标库配置(阿里和icomoon)">CSS图标库配置(阿里和icomoon)</a><time datetime="2023-10-18T03:42:00.000Z" title="发表于 2023-10-18 11:42:00">2023-10-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023  <i id="heartbeat" class="fa fas fa-heartbeat"></i> byxl8112</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div><<head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></head></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://vercel-comments-fu6q.vercel.app',
      region: 'us-east-1',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://vercel-comments-fu6q.vercel.app',
      region: 'us-east-1',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo@1/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script defer data-pjax type="text/javascript" src="https://npm.elemecdn.com/xianqi-hexo/js/animate.js"></script><div class="aplayer no-destroy" data-id="2358838077" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="auto" data-autoplay="false" muted></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="//code.tidio.co/null.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#posts-chart","#tags-chart","#categories-chart",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":160,"height":260},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>